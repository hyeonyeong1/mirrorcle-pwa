<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mirrorcle - AI ë¶„ì„ ë„êµ¬</title>
  
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="icon-128x128.png" /> 
  <!-- PWA ë©”íƒ€ íƒœê·¸ -->
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Mirrorcle">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Mirrorcle">
  
  <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
  <link rel="manifest" href="manifest.json">
  
  <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  
  <style>
    body {
      text-align: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
    }
    
    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .mode-selection {
      margin: 30px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .mode-selection h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5em;
    }
    
    .mode-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .mode-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      min-width: 200px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      touch-action: manipulation;
    }
    
    .mode-btn:hover, .mode-btn:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .mode-btn.emotion {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
    }
    
    .mode-btn.skin {
      background: linear-gradient(135deg, #48cae4 0%, #023e8a 100%);
    }
    
    .mode-description {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      line-height: 1.4;
    }

    /* í”¼ë¶€ íƒ€ì… ì„ íƒ í™”ë©´ */
    #skin-type-selection {
      margin: 30px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      display: none;
    }

    .skin-type-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .skin-type-btn {
      background: linear-gradient(135deg, #48cae4 0%, #023e8a 100%);
      border: none;
      color: white;
      padding: 20px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      touch-action: manipulation;
    }

    .skin-type-btn:hover, .skin-type-btn:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .skin-type-btn.selected {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    }

    .skin-type-desc {
      font-size: 12px;
      margin-top: 8px;
      opacity: 0.9;
      line-height: 1.3;
    }

    /* í™”ì¥í’ˆ ì¶”ì²œ ì„¹ì…˜ */
    #cosmetic-recommendation {
      margin: 20px auto;
      max-width: 800px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }

    .cosmetic-title {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
      text-align: center;
    }

    .cosmetic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .cosmetic-category {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 20px;
    }

    .category-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }

    .cosmetic-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
      transition: transform 0.2s ease;
    }

    .cosmetic-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .product-name {
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .product-brand {
      color: #666;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .product-description {
      color: #555;
      font-size: 13px;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .product-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .product-link {
      background: #ff6b35;
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      transition: background-color 0.3s;
      display: inline-block;
    }

    .product-link.oliveyoung {
      background: #00b894;
    }

    .product-link.coupang {
      background: #ff6b35;
    }

    .product-link:hover {
      opacity: 0.8;
    }
    
    #webcam-container {
      margin: 20px auto;
      display: inline-block;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      background: white;
      max-width: 100%;
    }
    
    canvas {
      border-radius: 12px;
      display: block;
      max-width: 100%;
      height: auto;
    }
    
    #status {
      font-size: 18px;
      margin: 20px;
      color: #333;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      line-height: 1.4;
    }
    
    #predictions {
      margin: 20px auto;
      max-width: 400px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #music-recommendation {
      margin: 20px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }
    
    .music-title {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
      text-align: center;
    }
    
    .music-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .music-item {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      transition: transform 0.2s ease;
      cursor: pointer;
      touch-action: manipulation;
    }
    
    .music-item:hover, .music-item:active {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .music-thumbnail {
      width: 100%;
      max-width: 240px;
      height: 135px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    
    .music-info {
      text-align: left;
    }
    
    .music-title-text {
      font-size: 14px;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .music-channel {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .play-button {
      background: #ff0000;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: background-color 0.3s;
      touch-action: manipulation;
    }
    
    .play-button:hover, .play-button:active {
      background: #cc0000;
    }
    
    .loading-music {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    
    .prediction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
      padding: 8px;
      border-radius: 6px;
      background: #f9f9f9;
    }
    
    .prediction-bar {
      width: 100px;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .prediction-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
      transition: width 0.3s ease;
    }
    
    button {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 12px 24px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      touch-action: manipulation;
      font-family: inherit;
    }
    
    button:hover, button:active {
      background: #45a049;
      transform: translateY(-1px);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    
    .error {
      color: #f44336;
      font-weight: bold;
    }
    
    .warning {
      color: #ff9800;
      font-weight: bold;
    }
    
    .back-btn {
      background: #6c757d;
      margin-bottom: 20px;
    }
    
    .back-btn:hover, .back-btn:active {
      background: #5a6268;
    }
    
    .main-content {
      display: none;
    }
    
    .mode-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }
    
    /* PWA ì„¤ì¹˜ ì•ˆë‚´ */
    .install-prompt {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
      animation: slideIn 0.5s ease-out;
    }
    
    .install-prompt.show {
      display: block;
    }
    
    .install-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .install-btn:hover, .install-btn:active {
      background: rgba(255,255,255,0.3);
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      h1 {
        font-size: 2em;
        margin-bottom: 20px;
      }
      
      .mode-selection {
        padding: 20px;
      }
      
      .mode-btn {
        min-width: 150px;
        padding: 15px 20px;
        font-size: 14px;
      }
      
      .mode-buttons {
        flex-direction: column;
        align-items: center;
      }

      .skin-type-buttons {
        grid-template-columns: 1fr;
      }

      .cosmetic-grid {
        grid-template-columns: 1fr;
      }
      
      .music-grid {
        grid-template-columns: 1fr;
      }
      
      #status {
        font-size: 16px;
        padding: 12px;
        margin: 15px;
      }
      
      canvas {
        max-width: 100%;
        height: auto;
      }
    }
    
    /* ì‘ì€ í™”ë©´ ëŒ€ì‘ */
    @media (max-width: 480px) {
      .mode-btn {
        min-width: 100%;
        margin-bottom: 10px;
      }
      
      .music-grid {
        gap: 10px;
      }
      
      .music-item {
        padding: 8px;
      }

      .product-links {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- PWA ì„¤ì¹˜ ì•ˆë‚´ -->
    <div id="installPrompt" class="install-prompt">
      ğŸ“± Mirrorcleì„ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•˜ì„¸ìš”!
      <br>
      <button id="installBtn" class="install-btn">í™ˆ í™”ë©´ì— ì¶”ê°€</button>
      <button onclick="hideInstallPrompt()" class="install-btn">ë‚˜ì¤‘ì—</button>
    </div>
    
    <h1>ğŸª Mirrorcle</h1>
    
    <!-- ëª¨ë“œ ì„ íƒ í™”ë©´ -->
    <div id="mode-selection" class="mode-selection">
      <h2>ë¶„ì„ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
      <div class="mode-buttons">
        <div>
          <button class="mode-btn emotion" onclick="selectMode('emotion')">
            ğŸ˜Š í‘œì • ê°ì • ì¸ì‹
          </button>
          <div class="mode-description">
            ì¹´ë©”ë¼ë¡œ í‘œì •ì„ ì¸ì‹í•˜ì—¬<br>ê°ì • ìƒíƒœë¥¼ ë¶„ì„í•©ë‹ˆë‹¤
          </div>
        </div>
        <div>
          <button class="mode-btn skin" onclick="selectMode('skin')">
            âœ¨ í”¼ë¶€ ìƒíƒœ ë¶„ì„
          </button>
          <div class="mode-description">
            ì–¼êµ´ì„ ì´¬ì˜í•˜ì—¬<br>í”¼ë¶€ ìƒíƒœë¥¼ ë¶„ì„í•©ë‹ˆë‹¤
          </div>
        </div>
      </div>
    </div>

    <!-- í”¼ë¶€ íƒ€ì… ì„ íƒ í™”ë©´ -->
    <div id="skin-type-selection">
      <h2>ë‹¹ì‹ ì˜ í”¼ë¶€ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
      <p style="color: #666; margin-bottom: 20px;">ì •í™•í•œ í™”ì¥í’ˆ ì¶”ì²œì„ ìœ„í•´ ë³¸ì¸ì˜ í”¼ë¶€ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
      
      <div class="skin-type-buttons">
        <button class="skin-type-btn" data-type="dry" onclick="selectSkinType('dry')">
          <div>ğŸœï¸ ê±´ì„± í”¼ë¶€</div>
          <div class="skin-type-desc">í”¼ë¶€ê°€ ê±´ì¡°í•˜ê³  ê°ì§ˆì´ ì¼ì–´ë‚˜ë©°<br>ë‹¹ê¹€ì´ ëŠê»´ì§€ëŠ” í”¼ë¶€</div>
        </button>
        <button class="skin-type-btn" data-type="oily" onclick="selectSkinType('oily')">
          <div>ğŸ’§ ì§€ì„± í”¼ë¶€</div>
          <div class="skin-type-desc">í”¼ì§€ ë¶„ë¹„ê°€ ë§ê³  ë²ˆë“¤ê±°ë¦¼ì´<br>ì‰½ê²Œ ë‚˜íƒ€ë‚˜ëŠ” í”¼ë¶€</div>
        </button>
        <button class="skin-type-btn" data-type="combination" onclick="selectSkinType('combination')">
          <div>ğŸŒ— ë³µí•©ì„± í”¼ë¶€</div>
          <div class="skin-type-desc">Tì¡´ì€ ê¸°ë¦„ì§€ê³  ë³¼ì€ ê±´ì¡°í•œ<br>ë¶€ìœ„ë³„ë¡œ ë‹¤ë¥¸ íŠ¹ì„±ì„ ê°€ì§„ í”¼ë¶€</div>
        </button>
        <button class="skin-type-btn" data-type="sensitive" onclick="selectSkinType('sensitive')">
          <div>ğŸŒ¸ ë¯¼ê°ì„± í”¼ë¶€</div>
          <div class="skin-type-desc">ì™¸ë¶€ ìê·¹ì— ì‰½ê²Œ ë°˜ì‘í•˜ê³ <br>ë¶‰ì–´ì§€ê±°ë‚˜ ë”°ê°€ìš´ í”¼ë¶€</div>
        </button>
      </div>
      
      <button id="confirmSkinType" onclick="confirmSkinTypeSelection()" style="display: none;">ì„ íƒ ì™„ë£Œ</button>
      <button class="back-btn" onclick="goBackToModeSelection()">â† ëª¨ë“œ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
    
    <!-- ë©”ì¸ ì½˜í…ì¸  -->    <div id="main-content" class="main-content">
      <button class="back-btn" onclick="goBack()">â† ëª¨ë“œ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      
      <div id="mode-title" class="mode-title"></div>
      
      <div id="webcam-container"></div>
      
      <div id="status">ì´ˆê¸°í™” ì¤‘...</div>
      
      <div id="predictions" style="display: none;">
        <h3>ì‹¤ì‹œê°„ ì˜ˆì¸¡ ê²°ê³¼</h3>
        <div id="prediction-list"></div>
      </div>
      
      <div id="music-recommendation">
        <div class="music-title">ğŸµ ë‹¹ì‹ ì˜ ê¸°ë¶„ì— ë§ëŠ” ìŒì•… ì¶”ì²œ</div>
        <div id="music-content"></div>
      </div>

      <!-- í™”ì¥í’ˆ ì¶”ì²œ ì„¹ì…˜ -->
      <div id="cosmetic-recommendation">
        <div class="cosmetic-title">ğŸ’„ ë‹¹ì‹ ì˜ í”¼ë¶€ì— ë§ëŠ” í™”ì¥í’ˆ ì¶”ì²œ</div>
        <div id="cosmetic-content"></div>
      </div>
      
      <div id="controls">
        <button id="startBtn" onclick="startDetection()" disabled>ë¶„ì„ ì‹œì‘</button>
        <button id="restartBtn" onclick="restart()" style="display: none;">ë‹¤ì‹œ ì‹œë„</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/3.18.0/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <script>
    let currentMode = '';
    let currentSkinType = '';
    let model, webcam, labelContainer, maxPredictions;
    let deferredPrompt;

    // í™”ì¥í’ˆ ì¶”ì²œ ë°ì´í„°
    const cosmeticRecommendations = {
      acne: {
        dry: [
          {
            category: "ì„¸ì•ˆì œ",
            name: "ì„¸íƒ€í•„ ì  í‹€ ìŠ¤í‚¨ í´ë Œì €",
            brand: "ì„¸íƒ€í•„",
            description: "ê±´ì„± ì—¬ë“œë¦„ í”¼ë¶€ë¥¼ ìœ„í•œ ìˆœí•œ ì„¸ì•ˆì œë¡œ í”¼ë¶€ ì¥ë²½ì„ ë³´í˜¸í•˜ë©´ì„œ ê¹¨ë—í•˜ê²Œ ì„¸ì •í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6751524299",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000139861"
            }
          },
          {
            category: "í† ë„ˆ",
            name: "í´ë¼ ì´ˆì´ìŠ¤ CALM ë¦¬ìŠ¤í† ë§ í† ë„ˆ",
            brand: "í´ë¼ ì´ˆì´ìŠ¤",
            description: "ê±´ì„± ë¯¼ê°ì„± í”¼ë¶€ë¥¼ ì§„ì •ì‹œí‚¤ê³  ìˆ˜ë¶„ì„ ê³µê¸‰í•˜ëŠ” ë¬´ì•Œì½”ì˜¬ í† ë„ˆì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5847382647",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000173912"
            }
          },
          {
            category: "ì—¬ë“œë¦„ ì¼€ì–´",
            name: "ë¼ë¡œìŠˆí¬ì œ ì—íŒí´ë¼ ë“€ì˜¤",
            brand: "ë¼ë¡œìŠˆí¬ì œ",
            description: "ê±´ì„± ì—¬ë“œë¦„ í”¼ë¶€ë¥¼ ìœ„í•œ ì§‘ì¤‘ ì¼€ì–´ ì œí’ˆìœ¼ë¡œ ë³´ìŠµê³¼ ì—¬ë“œë¦„ ì¼€ì–´ë¥¼ ë™ì‹œì— ì œê³µí•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6842951235",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000162847"
            }
          }
        ],
        oily: [
          {
            category: "ì„¸ì•ˆì œ",
            name: "ì„¸íƒ€í•„ í”„ë¡œ ì˜¤ì¼ ë¦¬ë¬´ë¹™ í¼",
            brand: "ì„¸íƒ€í•„",
            description: "ì§€ì„± ì—¬ë“œë¦„ í”¼ë¶€ë¥¼ ìœ„í•œ ë”¥í´ë Œì§• í¼ìœ¼ë¡œ ê³¼ë„í•œ ìœ ë¶„ê³¼ ëª¨ê³µ ì† ë…¸íë¬¼ì„ ì œê±°í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/7245681123",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000184729"
            }
          },
          {
            category: "í† ë„ˆ",
            name: "í´ë¼ ì´ˆì´ìŠ¤ SKIN PERFECTING 2% BHA",
            brand: "í´ë¼ ì´ˆì´ìŠ¤",
            description: "ì‚´ë¦¬ì‹¤ì‚°ì´ í•¨ìœ ëœ ê°ì§ˆ ì œê±° í† ë„ˆë¡œ ëª¨ê³µì„ ê¹¨ë—í•˜ê²Œ í•˜ê³  ì—¬ë“œë¦„ì„ ì˜ˆë°©í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5231847392",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000156732"
            }
          },
          {
            category: "ì—¬ë“œë¦„ ì¼€ì–´",
            name: "ë¹„í”¼ë‹¤ íŠ¸ëŸ¬ë¸” ì¼€ì–´ ìŠ¤íŒŸ íŒ¨ì¹˜",
            brand: "ë¹„í”¼ë‹¤",
            description: "ì§€ì„± í”¼ë¶€ ì—¬ë“œë¦„ì„ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ì§„ì •ì‹œí‚¤ê³  ì—¼ì¦ì„ ì™„í™”í•˜ëŠ” íŒ¨ì¹˜ì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6234891455",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000178934"
            }
          }
        ],
        combination: [
          {
            category: "ì„¸ì•ˆì œ",
            name: "ì•„ë²¤ëŠ í´ë¦¬ë‚­ìŠ¤ í´ë Œì§• ì ¤",
            brand: "ì•„ë²¤ëŠ",
            description: "ë³µí•©ì„± í”¼ë¶€ë¥¼ ìœ„í•œ ì•½ì‚°ì„± ì„¸ì•ˆì œë¡œ Tì¡´ì˜ ìœ ë¶„ì€ ì œê±°í•˜ê³  ë³¼ì˜ ìˆ˜ë¶„ì€ ìœ ì§€í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6951847123",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000149283"
            }
          },
          {
            category: "í† ë„ˆ",
            name: "í† ë‹ˆ&ê°€ì´ ë°¸ëŸ°ì‹± í† ë„ˆ",
            brand: "í† ë‹ˆ&ê°€ì´",
            description: "ë³µí•©ì„± í”¼ë¶€ì˜ ìœ ë¶„ê³¼ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì£¼ëŠ” ê· í˜• í† ë„ˆì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5847291647",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000167842"
            }
          },
          {
            category: "ì—¬ë“œë¦„ ì¼€ì–´",
            name: "ë”ì˜¤ë””ë„ˆë¦¬ ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ 10% + ì§•í¬ 1%",
            brand: "ë”ì˜¤ë””ë„ˆë¦¬",
            description: "ë³µí•©ì„± í”¼ë¶€ì˜ ëª¨ê³µì„ ì¶•ì†Œí•˜ê³  ìœ ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ì¡°ì ˆí•˜ì—¬ ì—¬ë“œë¦„ì„ ì˜ˆë°©í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6745823991",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000172956"
            }
          }
        ],
        sensitive: [
          {
            category: "ì„¸ì•ˆì œ",
            name: "ìœ ì„¸ë¦° ë”ë§ˆí† í´ë¦° ë§ˆì¼ë“œ í´ë Œì§• ë°€í¬",
            brand: "ìœ ì„¸ë¦°",
            description: "ë¯¼ê°ì„± í”¼ë¶€ë¥¼ ìœ„í•œ ìˆœí•œ í´ë Œì§• ë°€í¬ë¡œ ìê·¹ ì—†ì´ ë¶€ë“œëŸ½ê²Œ ì„¸ì •í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6234789123",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000145672"
            }
          },
          {
            category: "í† ë„ˆ",
            name: "ì•„ë²¤ëŠ ì¨ë©€ ì›Œí„° ìŠ¤í”„ë ˆì´",
            brand: "ì•„ë²¤ëŠ",
            description: "ë¯¼ê°ì„± í”¼ë¶€ë¥¼ ì§„ì •ì‹œí‚¤ëŠ” ì˜¨ì²œìˆ˜ ìŠ¤í”„ë ˆì´ë¡œ ì–¸ì œë“  ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5923847612",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000134827"
            }
          },
          {
            category: "ì—¬ë“œë¦„ ì¼€ì–´",
            name: "ë¼ë¡œìŠˆí¬ì œ ì‹œì¹´í”Œë¼ìŠ¤íŠ¸ ë°¤ B5",
            brand: "ë¼ë¡œìŠˆí¬ì œ", 
            description: "ë¯¼ê°ì„± í”¼ë¶€ì˜ ì—¼ì¦ì„ ì§„ì •ì‹œí‚¤ê³  í”¼ë¶€ ì¬ìƒì„ ë„ì™€ì£¼ëŠ” ì¼€ì–´ ì œí’ˆì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6847291034",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000158394"
            }
          }
        ]
      },
      trouble: {
        dry: [
          {
            category: "ìˆ˜ë¶„ í¬ë¦¼",
            name: "ì„¸ë¼ë²  ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§• í¬ë¦¼",
            brand: "ì„¸ë¼ë² ",
            description: "ê±´ì„± íŠ¸ëŸ¬ë¸” í”¼ë¶€ë¥¼ ìœ„í•œ ê³ ë³´ìŠµ í¬ë¦¼ìœ¼ë¡œ í”¼ë¶€ ì¥ë²½ì„ ê°•í™”í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6892347156",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000176234"
            }
          },
          {
            category: "ì•°í”Œ/ì„¸ëŸ¼",
            name: "ë”ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡œë‹‰ ì• ì‹œë“œ 2% + B5",
            brand: "ë”ì˜¤ë””ë„ˆë¦¬",
            description: "ê±´ì¡°í•œ íŠ¸ëŸ¬ë¸” í”¼ë¶€ì— ì§‘ì¤‘ì ì¸ ìˆ˜ë¶„ ê³µê¸‰ìœ¼ë¡œ í”¼ë¶€ë¥¼ ì§„ì •ì‹œí‚µë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5847392156",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000169847"
            }
          }
        ],
        oily: [
          {
            category: "ìˆ˜ë¶„ ì ¤",
            name: "ë‰´íŠ¸ë¡œì§€ë‚˜ í•˜ì´ë“œë¼ ë¶€ìŠ¤íŠ¸ ì›Œí„° ì ¤",
            brand: "ë‰´íŠ¸ë¡œì§€ë‚˜",
            description: "ì§€ì„± íŠ¸ëŸ¬ë¸” í”¼ë¶€ë¥¼ ìœ„í•œ ê°€ë²¼ìš´ ìˆ˜ë¶„ ì ¤ë¡œ ëˆì ì„ ì—†ì´ ë³´ìŠµí•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6234891723",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000184729"
            }
          },
          {
            category: "ì§„ì • ì•°í”Œ",
            name: "ì—ìŠ¤íŠ¸ë¼ ì•„í† ë² ë¦¬ì–´ 365 ë¡œì…˜",
            brand: "ì—ìŠ¤íŠ¸ë¼",
            description: "ì§€ì„± í”¼ë¶€ì˜ ì—¼ì¦ì„ ì§„ì •ì‹œí‚¤ê³  ê³¼ë„í•œ ìœ ë¶„ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5748392847",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000157823"
            }
          }
        ],
        combination: [
          {
            category: "ë°¸ëŸ°ì‹± ë¡œì…˜",
            name: "í‚¤ì—˜ ìš¸íŠ¸ë¼ í˜ì´ì…œ í¬ë¦¼",
            brand: "í‚¤ì—˜",
            description: "ë³µí•©ì„± í”¼ë¶€ì˜ ìœ ë¶„ê³¼ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì£¼ëŠ” ë§ŒëŠ¥ í¬ë¦¼ì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6847291556",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000142847"
            }
          },
          {
            category: "ì§„ì • ì„¸ëŸ¼",
            name: "í† ë¦¬ë“  ë‹¤ì´ë¸Œì¸ ë¡œìš° ëª°ë ˆí˜ íˆì•Œë£¨ë¡œë‹‰ ì• ì‹œë“œ ì„¸ëŸ¼",
            brand: "í† ë¦¬ë“ ",
            description: "ë³µí•©ì„± í”¼ë¶€ì˜ ë¶€ìœ„ë³„ ë‹¤ë¥¸ ìˆ˜ë¶„ ìš”êµ¬ëŸ‰ì„ ì¶©ì¡±ì‹œí‚¤ëŠ” ì„¸ëŸ¼ì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5923847234",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000178934"
            }
          }
        ],
        sensitive: [
          {
            category: "ì§„ì • í¬ë¦¼",
            name: "ë‹¥í„°ì§€ ë ˆë“œ ë¸”ë ˆë¯¸ì‰¬ í´ë¦¬ì–´ ìˆ˜ë”© í¬ë¦¼",
            brand: "ë‹¥í„°ì§€",
            description: "ë¯¼ê°ì„± í”¼ë¶€ì˜ í™ì¡°ì™€ íŠ¸ëŸ¬ë¸”ì„ ë™ì‹œì— ì¼€ì–´í•˜ëŠ” ì§„ì • í¬ë¦¼ì…ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/6234847192",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000167234"
            }
          },
          {
            category: "ì¬ìƒ ì•°í”Œ",
            name: "ë¼ë¡œìŠˆí¬ì œ í†¨ë ˆë¦¬ì•ˆ ìš¸íŠ¸ë¼ í¬ë¦¼",
            brand: "ë¼ë¡œìŠˆí¬ì œ",
            description: "ê·¹ë¯¼ê°ì„± í”¼ë¶€ë¥¼ ìœ„í•œ ë¬´ìê·¹ í¬ë¦¼ìœ¼ë¡œ í”¼ë¶€ ì¥ë²½ì„ ë³µêµ¬í•©ë‹ˆë‹¤.",
            links: {
              coupang: "https://www.coupang.com/vp/products/5847391234",
              oliveyoung: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000156789"
            }
          }
        ]
      }
    };

    // PWA ê´€ë ¨ ì½”ë“œ
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installPrompt').classList.add('show');
    });

    document.getElementById('installBtn').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        deferredPrompt = null;
        hideInstallPrompt();
      }
    });

    function hideInstallPrompt() {
      document.getElementById('installPrompt').classList.remove('show');
    }

    // ëª¨ë“œ ì„ íƒ í•¨ìˆ˜
    function selectMode(mode) {
      currentMode = mode;
      
      if (mode === 'skin') {
        // í”¼ë¶€ ëª¨ë“œì¸ ê²½ìš° í”¼ë¶€ íƒ€ì… ì„ íƒ í™”ë©´ìœ¼ë¡œ
        document.getElementById('mode-selection').style.display = 'none';
        document.getElementById('skin-type-selection').style.display = 'block';
      } else {
        // ê°ì • ëª¨ë“œì¸ ê²½ìš° ë°”ë¡œ ë©”ì¸ í™”ë©´ìœ¼ë¡œ
        showMainContent();
      }
    }

    // í”¼ë¶€ íƒ€ì… ì„ íƒ í•¨ìˆ˜
    function selectSkinType(type) {
      currentSkinType = type;
      
      // ëª¨ë“  ë²„íŠ¼ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
      document.querySelectorAll('.skin-type-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // ì„ íƒëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
      document.querySelector(`[data-type="${type}"]`).classList.add('selected');
      
      // í™•ì¸ ë²„íŠ¼ í‘œì‹œ
      document.getElementById('confirmSkinType').style.display = 'inline-block';
    }

    // í”¼ë¶€ íƒ€ì… ì„ íƒ í™•ì¸
    function confirmSkinTypeSelection() {
      if (currentSkinType) {
        showMainContent();
      }
    }

    // ë©”ì¸ ì½˜í…ì¸  í‘œì‹œ
    function showMainContent() {
      document.getElementById('mode-selection').style.display = 'none';
      document.getElementById('skin-type-selection').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      
      if (currentMode === 'emotion') {
        document.getElementById('mode-title').textContent = 'ğŸ˜Š í‘œì • ê°ì • ì¸ì‹';
        initEmotionDetection();
      } else if (currentMode === 'skin') {
        document.getElementById('mode-title').textContent = 'âœ¨ í”¼ë¶€ ìƒíƒœ ë¶„ì„';
        initSkinAnalysis();
      }
    }

    // ëª¨ë“œ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function goBackToModeSelection() {
      document.getElementById('skin-type-selection').style.display = 'none';
      document.getElementById('mode-selection').style.display = 'block';
      currentSkinType = '';
      document.getElementById('confirmSkinType').style.display = 'none';
      document.querySelectorAll('.skin-type-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
    }

    function goBack() {
      if (currentMode === 'skin') {
        // í”¼ë¶€ ëª¨ë“œì¸ ê²½ìš° í”¼ë¶€ íƒ€ì… ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('skin-type-selection').style.display = 'block';
      } else {
        // ê°ì • ëª¨ë“œì¸ ê²½ìš° ëª¨ë“œ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('mode-selection').style.display = 'block';
      }
      
      // ì›¹ìº  ì •ë¦¬
      if (webcam) {
        webcam.stop();
      }
      
      // ì¶”ì²œ ìˆ¨ê¸°ê¸°
      document.getElementById('music-recommendation').style.display = 'none';
      document.getElementById('cosmetic-recommendation').style.display = 'none';
      document.getElementById('predictions').style.display = 'none';
      
      // ìƒíƒœ ì´ˆê¸°í™”
      currentMode = '';
      if (currentMode !== 'skin') {
        currentSkinType = '';
      }
    }

    // ê°ì • ì¸ì‹ ì´ˆê¸°í™”
    async function initEmotionDetection() {
      try {
        document.getElementById('status').textContent = 'ê°ì • ì¸ì‹ ëª¨ë¸ì„ ë¡œë”© ì¤‘...';
        
        const modelURL = 'https://teachablemachine.withgoogle.com/models/your-emotion-model/model.json';
        const metadataURL = 'https://teachablemachine.withgoogle.com/models/your-emotion-model/metadata.json';
        
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        
        const flip = true;
        webcam = new tmImage.Webcam(320, 240, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loopEmotion);
        
        document.getElementById('webcam-container').appendChild(webcam.canvas);
        document.getElementById('status').innerHTML = '<span class="success">âœ“ ì¤€ë¹„ ì™„ë£Œ! ë¶„ì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>';
        document.getElementById('startBtn').disabled = false;
        
      } catch (error) {
        console.error('ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:', error);
        document.getElementById('status').innerHTML = '<span class="error">âœ— ëª¨ë¸ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</span>';
      }
    }

    // í”¼ë¶€ ë¶„ì„ ì´ˆê¸°í™”
    async function initSkinAnalysis() {
      try {
        document.getElementById('status').textContent = 'í”¼ë¶€ ë¶„ì„ ëª¨ë¸ì„ ë¡œë”© ì¤‘...';
        
        const modelURL = 'https://teachablemachine.withgoogle.com/models/your-skin-model/model.json';
        const metadataURL = 'https://teachablemachine.withgoogle.com/models/your-skin-model/metadata.json';
        
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        
        const flip = true;
        webcam = new tmImage.Webcam(320, 240, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loopSkin);
        
        document.getElementById('webcam-container').appendChild(webcam.canvas);
        document.getElementById('status').innerHTML = '<span class="success">âœ“ ì¤€ë¹„ ì™„ë£Œ! ë¶„ì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>';
        document.getElementById('startBtn').disabled = false;
        
      } catch (error) {
        console.error('ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:', error);
        document.getElementById('status').innerHTML = '<span class="error">âœ— ëª¨ë¸ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</span>';
      }
    }

    // ê°ì • ì¸ì‹ ë£¨í”„
    async function loopEmotion() {
      webcam.update();
      if (document.getElementById('startBtn').style.display !== 'none') {
        await predictEmotion();
      }
      window.requestAnimationFrame(loopEmotion);
    }

    // í”¼ë¶€ ë¶„ì„ ë£¨í”„
    async function loopSkin() {
      webcam.update();
      if (document.getElementById('startBtn').style.display !== 'none') {
        await predictSkin();
      }
      window.requestAnimationFrame(loopSkin);
    }

    // ê°ì • ì˜ˆì¸¡
    async function predictEmotion() {
      const prediction = await model.predict(webcam.canvas);
      
      let predictionHTML = '';
      for (let i = 0; i < maxPredictions; i++) {
        const percentage = Math.round(prediction[i].probability * 100);
        predictionHTML += `
          <div class="prediction-item">
            <span>${prediction[i].className}</span>
            <div class="prediction-bar">
              <div class="prediction-fill" style="width: ${percentage}%"></div>
            </div>
            <span>${percentage}%</span>
          </div>
        `;
      }
      
      document.getElementById('prediction-list').innerHTML = predictionHTML;
      
      // ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ê°ì • ì°¾ê¸°
      const topPrediction = prediction.reduce((prev, current) => 
        (prev.probability > current.probability) ? prev : current
      );
      
      if (topPrediction.probability > 0.7) {
        showMusicRecommendation(topPrediction.className);
      }
    }

    // í”¼ë¶€ ì˜ˆì¸¡
    async function predictSkin() {
      const prediction = await model.predict(webcam.canvas);
      
      let predictionHTML = '';
      for (let i = 0; i < maxPredictions; i++) {
        const percentage = Math.round(prediction[i].probability * 100);
        predictionHTML += `
          <div class="prediction-item">
            <span>${prediction[i].className}</span>
            <div class="prediction-bar">
              <div class="prediction-fill" style="width: ${percentage}%"></div>
            </div>
            <span>${percentage}%</span>
          </div>
        `;
      }
      
      document.getElementById('prediction-list').innerHTML = predictionHTML;
      
      // ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ í”¼ë¶€ ìƒíƒœ ì°¾ê¸°
      const topPrediction = prediction.reduce((prev, current) => 
        (prev.probability > current.probability) ? prev : current
      );
      
      if (topPrediction.probability > 0.7) {
        showCosmeticRecommendation(topPrediction.className);
      }
    }

    // ìŒì•… ì¶”ì²œ í‘œì‹œ
    function showMusicRecommendation(emotion) {
      const musicDiv = document.getElementById('music-recommendation');
      musicDiv.style.display = 'block';
      
      // ê°ì •ë³„ ìŒì•… ì¶”ì²œ ë¡œì§ (ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼)
      // ì—¬ê¸°ì— ê¸°ì¡´ ìŒì•… ì¶”ì²œ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    }

    // í™”ì¥í’ˆ ì¶”ì²œ í‘œì‹œ
    function showCosmeticRecommendation(skinCondition) {
      if (!currentSkinType) return;
      
      const cosmeticDiv = document.getElementById('cosmetic-recommendation');
      const contentDiv = document.getElementById('cosmetic-content');
      
      let recommendationType = '';
      if (skinCondition.toLowerCase().includes('acne') || skinCondition.toLowerCase().includes('ì—¬ë“œë¦„')) {
        recommendationType = 'acne';
      } else if (skinCondition.toLowerCase().includes('trouble') || skinCondition.toLowerCase().includes('íŠ¸ëŸ¬ë¸”')) {
        recommendationType = 'trouble';
      }
      
      if (recommendationType && cosmeticRecommendations[recommendationType] && cosmeticRecommendations[recommendationType][currentSkinType]) {
        const products = cosmeticRecommendations[recommendationType][currentSkinType];
        
        let html = `<div class="cosmetic-grid">`;
        
        // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì œí’ˆ ì •ë¦¬
        const categories = {};
        products.forEach(product => {
          if (!categories[product.category]) {
            categories[product.category] = [];
          }
          categories[product.category].push(product);
        });
        
        Object.keys(categories).forEach(category => {
          html += `
            <div class="cosmetic-category">
              <div class="category-title">${category}</div>`;
          
          categories[category].forEach(product => {
            html += `
              <div class="cosmetic-item">
                <div class="product-name">${product.name}</div>
                <div class="product-brand">${product.brand}</div>
                <div class="product-description">${product.description}</div>
                <div class="product-links">
                  <a href="${product.links.coupang}" class="product-link coupang" target="_blank">ì¿ íŒ¡ì—ì„œ ë³´ê¸°</a>
                  <a href="${product.links.oliveyoung}" class="product-link oliveyoung" target="_blank">ì˜¬ë¦¬ë¸Œì˜ì—ì„œ ë³´ê¸°</a>
                </div>
              </div>`;
          });
          
          html += `</div>`;
        });
        
        html += `</div>`;
        contentDiv.innerHTML = html;
        cosmeticDiv.style.display = 'block';
      }
    }

    // ë¶„ì„ ì‹œì‘
    function startDetection() {
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'inline-block';
      document.getElementById('predictions').style.display = 'block';
      document.getElementById('status').innerHTML = '<span class="success">ë¶„ì„ ì¤‘... ì¹´ë©”ë¼ë¥¼ ì •ë©´ìœ¼ë¡œ ë°”ë¼ë³´ì„¸ìš”!</span>';
    }

    // ì¬ì‹œì‘
    function restart() {
      document.getElementById('startBtn').style.display = 'inline-block';
      document.getElementById('restartBtn').style.display = 'none';
      document.getElementById('predictions').style.display = 'none';
      document.getElementById('music-recommendation').style.display = 'none';
      document.getElementById('cosmetic-recommendation').style.display = 'none';
      document.getElementById('status').innerHTML = '<span class="success">âœ“ ì¤€ë¹„ ì™„ë£Œ! ë¶„ì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>';
    }

    // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
</body>
</html>
