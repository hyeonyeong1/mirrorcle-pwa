<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mirrorcle - AI ë¶„ì„ ë„êµ¬</title>
  

  <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="icon-128x128.png" /> 

  <!-- PWA ë©”íƒ€ íƒœê·¸ -->
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Mirrorcle">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Mirrorcle">
  
  <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
  <link rel="manifest" href="manifest.json">
  
  <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  
  <style>
    body {
      text-align: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
    }
    
    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .mode-selection {
      margin: 30px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .mode-selection h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5em;
    }
    
    .mode-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .mode-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      min-width: 200px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      touch-action: manipulation;
    }
    
    .mode-btn:hover, .mode-btn:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .mode-btn.emotion {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
    }
    
    .mode-btn.skin {
      background: linear-gradient(135deg, #48cae4 0%, #023e8a 100%);
    }
    
    .mode-description {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      line-height: 1.4;
    }
    
    #webcam-container {
      margin: 20px auto;
      display: inline-block;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      background: white;
      max-width: 100%;
    }
    
    canvas {
      border-radius: 12px;
      display: block;
      max-width: 100%;
      height: auto;
    }
    
    #status {
      font-size: 18px;
      margin: 20px;
      color: #333;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      line-height: 1.4;
    }
    
    #predictions {
      margin: 20px auto;
      max-width: 400px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* í”¼ë¶€ íƒ€ì… ì„ íƒ ì„¹ì…˜ */
    #skin-type-selection {
      margin: 20px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }
    
    .skin-type-title {
      font-size: 22px;
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }
    
    .skin-type-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .skin-type-btn {
      background: linear-gradient(135deg, #48cae4 0%, #023e8a 100%);
      border: none;
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      touch-action: manipulation;
    }
    
    .skin-type-btn:hover, .skin-type-btn:active {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    .skin-type-btn.selected {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      transform: translateY(-2px);
    }
    
    .skin-type-description {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      line-height: 1.3;
    }
    
    /* í™”ì¥í’ˆ ì¶”ì²œ ì„¹ì…˜ */
    #cosmetic-recommendation {
      margin: 20px auto;
      max-width: 800px;
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }
    
    .cosmetic-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }
    
    .cosmetic-category {
      margin-bottom: 30px;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
    }
    
    .category-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      text-align: left;
    }
    
    .cosmetic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }
    
    .cosmetic-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    
    .cosmetic-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    
    .cosmetic-name {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    
    .cosmetic-description {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
      line-height: 1.4;
    }
    
    .cosmetic-links {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    .cosmetic-link {
      padding: 8px 16px;
      border-radius: 20px;
      text-decoration: none;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
      touch-action: manipulation;
    }
    
    .coupang-link {
      background: #ff6b35;
      color: white;
    }
    
    .coupang-link:hover {
      background: #e55a2b;
      transform: translateY(-1px);
    }
    
    .oliveyoung-link {
      background: #00c851;
      color: white;
    }
    
    .oliveyoung-link:hover {
      background: #00a63f;
      transform: translateY(-1px);
    }
    
    #music-recommendation {
      margin: 20px auto;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }
    
    .music-title {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
      text-align: center;
    }
    
    .music-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .music-item {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      transition: transform 0.2s ease;
      cursor: pointer;
      touch-action: manipulation;
    }
    
    .music-item:hover, .music-item:active {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .music-thumbnail {
      width: 100%;
      max-width: 240px;
      height: 135px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    
    .music-info {
      text-align: left;
    }
    
    .music-title-text {
      font-size: 14px;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .music-channel {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .play-button {
      background: #ff0000;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: background-color 0.3s;
      touch-action: manipulation;
    }
    
    .play-button:hover, .play-button:active {
      background: #cc0000;
    }
    
    .loading-music {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    
    .prediction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
      padding: 8px;
      border-radius: 6px;
      background: #f9f9f9;
    }
    
    .prediction-bar {
      width: 100px;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .prediction-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
      transition: width 0.3s ease;
    }
    
    button {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 12px 24px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      touch-action: manipulation;
      font-family: inherit;
    }
    
    button:hover, button:active {
      background: #45a049;
      transform: translateY(-1px);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    
    .error {
      color: #f44336;
      font-weight: bold;
    }
    
    .warning {
      color: #ff9800;
      font-weight: bold;
    }
    
    .back-btn {
      background: #6c757d;
      margin-bottom: 20px;
    }
    
    .back-btn:hover, .back-btn:active {
      background: #5a6268;
    }
    
    .main-content {
      display: none;
    }
    
    .mode-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }
    
    /* PWA ì„¤ì¹˜ ì•ˆë‚´ */
    .install-prompt {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
      animation: slideIn 0.5s ease-out;
    }
    
    .install-prompt.show {
      display: block;
    }
    
    .install-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .install-btn:hover, .install-btn:active {
      background: rgba(255,255,255,0.3);
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      h1 {
        font-size: 2em;
        margin-bottom: 20px;
      }
      
      .mode-selection {
        padding: 20px;
      }
      
      .mode-btn {
        min-width: 150px;
        padding: 15px 20px;
        font-size: 14px;
      }
      
      .mode-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .music-grid {
        grid-template-columns: 1fr;
      }
      
      .cosmetic-grid {
        grid-template-columns: 1fr;
      }
      
      .skin-type-buttons {
        grid-template-columns: repeat(2, 1fr);
      }
      
      #status {
        font-size: 16px;
        padding: 12px;
        margin: 15px;
      }
      
      canvas {
        max-width: 100%;
        height: auto;
      }
    }
    
    /* ì‘ì€ í™”ë©´ ëŒ€ì‘ */
    @media (max-width: 480px) {
      .mode-btn {
        min-width: 100%;
        margin-bottom: 10px;
      }
      
      .music-grid {
        gap: 10px;
      }
      
      .music-item {
        padding: 8px;
      }
      
      .skin-type-buttons {
        grid-template-columns: 1fr;
      }
      
      .cosmetic-links {
        flex-direction: column;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- PWA ì„¤ì¹˜ ì•ˆë‚´ -->
    <div id="installPrompt" class="install-prompt">
      ğŸ“± Mirrorcleì„ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•˜ì„¸ìš”!
      <br>
      <button id="installBtn" class="install-btn">í™ˆ í™”ë©´ì— ì¶”ê°€</button>
      <button onclick="hideInstallPrompt()" class="install-btn">ë‚˜ì¤‘ì—</button>
    </div>
    
    <h1>ğŸª Mirrorcle</h1>
    
    <!-- ëª¨ë“œ ì„ íƒ í™”ë©´ -->
    <div id="mode-selection" class="mode-selection">
      <h2>ë¶„ì„ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
      <div class="mode-buttons">
        <div>
          <button class="mode-btn emotion" onclick="selectMode('emotion')">
            ğŸ˜Š í‘œì • ê°ì • ì¸ì‹
          </button>
          <div class="mode-description">
            ì¹´ë©”ë¼ë¡œ í‘œì •ì„ ì¸ì‹í•˜ì—¬<br>ê°ì • ìƒíƒœë¥¼ ë¶„ì„í•©ë‹ˆë‹¤
          </div>
        </div>
        <div>
          <button class="mode-btn skin" onclick="selectMode('skin')">
            âœ¨ í”¼ë¶€ ìƒíƒœ ë¶„ì„
          </button>
          <div class="mode-description">
            ì–¼êµ´ì„ ì´¬ì˜í•˜ì—¬<br>í”¼ë¶€ ìƒíƒœë¥¼ ë¶„ì„í•©ë‹ˆë‹¤
          </div>
        </div>
      </div>
    </div>
    
    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div id="main-content" class="main-content">
      <button class="back-btn" onclick="goBack()">â† ëª¨ë“œ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      
      <div id="mode-title" class="mode-title"></div>
      
      <div id="webcam-container"></div>
      
      <div id="status">ì´ˆê¸°í™” ì¤‘...</div>
      
      <div id="predictions" style="display: none;">
        <h3>ì‹¤ì‹œê°„ ì˜ˆì¸¡ ê²°ê³¼</h3>
        <div id="prediction-list"></div>
      </div>
      
      <!-- í”¼ë¶€ íƒ€ì… ì„ íƒ ì„¹ì…˜ -->
      <div id="skin-type-selection">
        <div class="skin-type-title">ğŸ” í”¼ë¶€ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
        <div class="skin-type-buttons">
          <div>
            <button class="skin-type-btn" data-type="combination" onclick="selectSkinType('combination')">
              ë³µí•©ì„± í”¼ë¶€
            </button>
            <div class="skin-type-description">Tì¡´ì€ ê¸°ë¦„ì§€ê³ <br>ë³¼ì€ ê±´ì¡°í•œ í”¼ë¶€</div>
          </div>
          <div>
            <button class="skin-type-btn" data-type="oily" onclick="selectSkinType('oily')">
              ì§€ì„± í”¼ë¶€
            </button>
            <div class="skin-type-description">ìœ ë¶„ì´ ë§ê³ <br>ë²ˆë“¤ê±°ë¦¬ëŠ” í”¼ë¶€</div>
          </div>
          <div>
            <button class="skin-type-btn" data-type="sensitive" onclick="selectSkinType('sensitive')">
              ë¯¼ê°ì„± í”¼ë¶€
            </button>
            <div class="skin-type-description">ìê·¹ì— ì‰½ê²Œ<br>ë°˜ì‘í•˜ëŠ” í”¼ë¶€</div>
          </div>
          <div>
            <button class="skin-type-btn" data-type="dry" onclick="selectSkinType('dry')">
              ê±´ì„± í”¼ë¶€
            </button>
            <div class="skin-type-description">ìˆ˜ë¶„ì´ ë¶€ì¡±í•˜ê³ <br>ê±°ì¹ ì–´ì§€ê¸° ì‰¬ìš´ í”¼ë¶€</div>
          </div>
        </div>
      </div>
      
      <!-- í™”ì¥í’ˆ ì¶”ì²œ ì„¹ì…˜ -->
      <div id="cosmetic-recommendation">
        <div class="cosmetic-title">ğŸ’„ ë§ì¶¤ í™”ì¥í’ˆ ì¶”ì²œ</div>
        <div id="cosmetic-content"></div>
      </div>
      
      <div id="music-recommendation">
        <div class="music-title">ğŸµ ë‹¹ì‹ ì˜ ê¸°ë¶„ì— ë§ëŠ” ìŒì•… ì¶”ì²œ</div>
        <div id="music-content"></div>
      </div>
      
      <div id="controls">
        <button id="startBtn" onclick="startDetection()" disabled>ë¶„ì„ ì‹œì‘</button>
        <button id="restartBtn" onclick="restart()" style="display: none;">ë‹¤ì‹œ ì‹œë„</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/3.18.0/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <script>
    // í”¼ë¶€ íƒ€ì…ë³„ í™”ì¥í’ˆ ë°ì´í„°
    const cosmeticData = {
      combination: {
        title: "ë³µí•©ì„± í”¼ë¶€ ë§ì¶¤ í™”ì¥í’ˆ",
        categories: [
          {
            name: "í´ë Œì €",
            products: [
              {
                name: "ì„¸íƒ€í•„ ë°ì¼ë¦¬ í˜ì´ì…œ í´ë Œì €",
                description: "ìˆœí•œ ì„±ë¶„ìœ¼ë¡œ Tì¡´ê³¼ ë³¼ì„ ë™ì‹œì— ì¼€ì–´í•˜ëŠ” ì  í‹€ í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/1234567890",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000123456"
              },
              {
                name: "ì´ë‹ˆìŠ¤í”„ë¦¬ ê·¸ë¦°í‹° í¼ í´ë Œì§•",
                description: "ë…¹ì°¨ ì„±ë¶„ìœ¼ë¡œ ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì£¼ëŠ” í¼ í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/1234567891",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000123457"
              }
            ]
          },
          {
            name: "í† ë„ˆ",
            products: [
              {
                name: "ì•„ì´ì˜¤í˜ ë°”ì´ì˜¤ ì¸í…ì‹œë¸Œ ì»¨ë””ì…”ë‹ ì•„ì´ì˜¤",
                description: "ë³µí•©ì„± í”¼ë¶€ì˜ ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì£¼ëŠ” ë“€ì–¼ ì¼€ì–´ í† ë„ˆ",
                coupangUrl: "https://www.coupang.com/vp/products/1234567892",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000123458"
              }
            ]
          },
          {
            name: "ë³´ìŠµì œ",
            products: [
              {
                name: "í´ë¦¬ë‹ˆí¬ ë“œë¼ë§ˆí‹°ì»¬ë¦¬ ë””í¼ëŸ°íŠ¸ ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§• ì ¤",
                description: "Tì¡´ì€ ì‚°ëœ»í•˜ê²Œ, ë³¼ì€ ì´‰ì´‰í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ì ¤ íƒ€ì… ë³´ìŠµì œ",
                coupangUrl: "https://www.coupang.com/vp/products/1234567893",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000123459"
              }
            ]
          }
        ]
      },
      oily: {
        title: "ì§€ì„± í”¼ë¶€ ë§ì¶¤ í™”ì¥í’ˆ",
        categories: [
          {
            name: "í´ë Œì €",
            products: [
              {
                name: "í´ë¼ ì´ˆì´ìŠ¤ CLEAR í¬ì–´ ë…¸ë©€ë¼ì´ì§• í´ë Œì €",
                description: "ê³¼ë„í•œ ìœ ë¶„ì„ ì œê±°í•˜ê³  ëª¨ê³µì„ ê¹¨ë—í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/2234567890",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000223456"
              },
              {
                name: "ì½”ìŠ¤ì•Œì—‘ìŠ¤ ì‚´ë¦¬ì‹¤ë¦­ì• ì”¨ë“œ ë°ì¼ë¦¬ ì  í‹€ í´ë Œì €",
                description: "BHA ì„±ë¶„ìœ¼ë¡œ ê°ì§ˆê³¼ ìœ ë¶„ì„ ë™ì‹œì— ê´€ë¦¬í•˜ëŠ” ì  í‹€ í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/2234567891",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000223457"
              }
            ]
          },
          {
            name: "í† ë„ˆ",
            products: [
              {
                name: "íŒŒìš¸ë¼ì´ˆì´ìŠ¤ ìŠ¤í‚¨ í¼í™íŒ… 2% BHA ë¦¬í€´ë“œ",
                description: "ì§€ì„± í”¼ë¶€ì˜ ë¸”ë™í—¤ë“œì™€ ëª¨ê³µ ê´€ë¦¬ì— íš¨ê³¼ì ì¸ BHA í† ë„ˆ",
                coupangUrl: "https://www.coupang.com/vp/products/2234567892",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000223458"
              }
            ]
          },
          {
            name: "ë³´ìŠµì œ",
            products: [
              {
                name: "ì„¸ë¼ë²  PM í˜ì´ì…œ ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§• ë¡œì…˜",
                description: "ê°€ë²¼ìš´ ì§ˆê°ìœ¼ë¡œ ìœ ë¶„ê° ì—†ì´ ìˆ˜ë¶„ì„ ê³µê¸‰í•˜ëŠ” ë‚˜ì´íŠ¸ ë¡œì…˜",
                coupangUrl: "https://www.coupang.com/vp/products/2234567893",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000223459"
              }
            ]
          }
        ]
      },
      sensitive: {
        title: "ë¯¼ê°ì„± í”¼ë¶€ ë§ì¶¤ í™”ì¥í’ˆ",
        categories: [
          {
            name: "í´ë Œì €",
            products: [
              {
                name: "ì•„ë²¤ëŠ ì  í‹€ ë°€í¬ í´ë Œì €",
                description: "ë¯¼ê°í•œ í”¼ë¶€ë„ ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìˆœí•œ ë°€í¬ í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/3234567890",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000323456"
              },
              {
                name: "ë¼ë¡œìŠˆí¬ì œ í†¨ëŸ¬ë¦¬ì•ˆ ì¼€ì–´ë§ ì›Œì‹œ",
                description: "ë¯¸ë‹ˆë©€ ì„±ë¶„ìœ¼ë¡œ ìê·¹ ì—†ì´ ì„¸ì •í•˜ëŠ” ë¯¼ê°ì„± í”¼ë¶€ ì „ìš© í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/3234567891",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000323457"
              }
            ]
          },
          {
            name: "í† ë„ˆ",
            products: [
              {
                name: "ì•„ë²¤ëŠ ì¨ë©€ ìŠ¤í”„ë§ ì›Œí„°",
                description: "ë¯¼ê°í•œ í”¼ë¶€ë¥¼ ì§„ì •ì‹œí‚¤ëŠ” ìˆœìˆ˜ ì˜¨ì²œìˆ˜ í† ë„ˆ",
                coupangUrl: "https://www.coupang.com/vp/products/3234567892",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000323458"
              }
            ]
          },
          {
            name: "ë³´ìŠµì œ",
            products: [
              {
                name: "ì„¸ë¼ë²  ë°ì¼ë¦¬ ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§• ë¡œì…˜",
                description: "ì„¸ë¼ë§ˆì´ë“œ ì„±ë¶„ìœ¼ë¡œ ë¯¼ê°í•œ í”¼ë¶€ ì¥ë²½ì„ ê°•í™”í•˜ëŠ” ë¡œì…˜",
                coupangUrl: "https://www.coupang.com/vp/products/3234567893",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000323459"
              }
            ]
          }
        ]
      },
      dry: {
        title: "ê±´ì„± í”¼ë¶€ ë§ì¶¤ í™”ì¥í’ˆ",
        categories: [
          {
            name: "í´ë Œì €",
            products: [
              {
                name: "ì„¸íƒ€í•„ ì  í‹€ ìŠ¤í‚¨ í´ë Œì €",
                description: "ê±´ì¡°í•œ í”¼ë¶€ë¥¼ ë¶€ë“œëŸ½ê²Œ ì„¸ì •í•˜ëŠ” ë¬´ìê·¹ í´ë Œì €",
                coupangUrl: "https://www.coupang.com/vp/products/4234567890",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000423456"
              },
              {
                name: "í´ë¦¬ë‹ˆí¬ ìµìŠ¤íŠ¸ë¼ ë§ˆì¼ë“œ ì•¡ì…˜ í´ë Œì§• í¼",
                description: "ìˆ˜ë¶„ì„ ë¹¼ì•—ì§€ ì•Šê³  ë¶€ë“œëŸ½ê²Œ ì„¸ì •í•˜ëŠ” ê±´ì„± í”¼ë¶€ìš© í¼",
                coupangUrl: "https://www.coupang.com/vp/products/4234567891",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000423457"
              }
            ]
          },
          {
            name: "í† ë„ˆ",
            products: [
              {
                name: "í—¤ë¼ ì…€ ì—ì„¼ìŠ¤",
                description: "ê¹Šì€ ìˆ˜ë¶„ ê³µê¸‰ìœ¼ë¡œ ê±´ì¡°í•œ í”¼ë¶€ë¥¼ ì´‰ì´‰í•˜ê²Œ ë§Œë“œëŠ” ì—ì„¼ìŠ¤ í† ë„ˆ",
                coupangUrl: "https://www.coupang.com/vp/products/4234567892",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000423458"
              }
            ]
          },
          {
            name: "ë³´ìŠµì œ",
            products: [
              {
                name: "ì˜¤íœ˜ ë¯¸ë¼í´ ì•„ì¿ ì•„ ì¸í…ì‹œë¸Œ í¬ë¦¼",
                description: "íˆì•Œë£¨ë¡ ì‚°ìœ¼ë¡œ ê¹Šì€ ë³´ìŠµì„ ì œê³µí•˜ëŠ” ê³ ë³´ìŠµ í¬ë¦¼",
                coupangUrl: "https://www.coupang.com/vp/products/4234567893",
                oliveyoungUrl: "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000423459"
              }
            ]
          }
        ]
      }
    };

    // ì „ì—­ ë³€ìˆ˜ë“¤
    let currentMode = '';
    let model = null;
    let webcam = null;
    let labelContainer = null;
    let maxPredictions = 0;
    let selectedSkinType = '';

    // PWA ì„¤ì¹˜ ê´€ë ¨
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    const installPrompt = document.getElementById('installPrompt');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallPrompt();
    });

    function showInstallPrompt() {
      installPrompt.classList.add('show');
    }

    function hideInstallPrompt() {
      installPrompt.classList.remove('show');
    }

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          hideInstallPrompt();
        }
        deferredPrompt = null;
      }
    });

    // ëª¨ë“œ ì„ íƒ í•¨ìˆ˜
    function selectMode(mode) {
      currentMode = mode;
      document.getElementById('mode-selection').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      
      if (mode === 'emotion') {
        document.getElementById('mode-title').textContent = 'ğŸ˜Š í‘œì • ê°ì • ì¸ì‹';
        init();
      } else if (mode === 'skin') {
        document.getElementById('mode-title').textContent = 'âœ¨ í”¼ë¶€ ìƒíƒœ ë¶„ì„';
        init();
      }
    }

    // ë’¤ë¡œê°€ê¸° í•¨ìˆ˜
    function goBack() {
      document.getElementById('mode-selection').style.display = 'block';
      document.getElementById('main-content').style.display = 'none';
      document.getElementById('skin-type-selection').style.display = 'none';
      document.getElementById('cosmetic-recommendation').style.display = 'none';
      document.getElementById('music-recommendation').style.display = 'none';
      currentMode = '';
      selectedSkinType = '';
      
      if (webcam) {
        webcam.stop();
      }
    }

    // ì´ˆê¸°í™” í•¨ìˆ˜
    async function init() {
      const modelURL = currentMode === 'emotion' 
        ? 'https://teachablemachine.withgoogle.com/models/your-emotion-model/'
        : 'https://teachablemachine.withgoogle.com/models/your-skin-model/';
      const metadataURL = modelURL + 'metadata.json';

      try {
        document.getElementById('status').innerHTML = 'ëª¨ë¸ì„ ë¡œë”© ì¤‘...';
        
        // ì‹¤ì œ ëª¨ë¸ì´ ì—†ìœ¼ë¯€ë¡œ ì‹œë®¬ë ˆì´ì…˜
        setTimeout(() => {
          document.getElementById('status').innerHTML = 'ì›¹ìº ì„ ì´ˆê¸°í™” ì¤‘...';
          initWebcam();
        }, 1000);
        
      } catch (error) {
        console.error('ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:', error);
        document.getElementById('status').innerHTML = '<span class="error">ëª¨ë¸ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }

    // ì›¹ìº  ì´ˆê¸°í™”
    async function initWebcam() {
      try {
        const constraints = {
          video: { 
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }
        };
        
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        
        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;
        video.playsInline = true;
        video.style.width = '100%';
        video.style.maxWidth = '640px';
        video.style.height = 'auto';
        video.style.borderRadius = '12px';
        
        document.getElementById('webcam-container').innerHTML = '';
        document.getElementById('webcam-container').appendChild(video);
        
        document.getElementById('status').innerHTML = '<span class="success">ì¤€ë¹„ ì™„ë£Œ! ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</span>';
        document.getElementById('startBtn').disabled = false;
        
        webcam = { video: video, stop: () => stream.getTracks().forEach(track => track.stop()) };
        
      } catch (error) {
        console.error('ì›¹ìº  ì ‘ê·¼ ì‹¤íŒ¨:', error);
        document.getElementById('status').innerHTML = '<span class="error">ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</span>';
      }
    }

    // ê°ì§€ ì‹œì‘
    function startDetection() {
      if (currentMode === 'emotion') {
        startEmotionDetection();
      } else if (currentMode === 'skin') {
        startSkinDetection();
      }
    }

    // í‘œì • ê°ì • ì¸ì‹ ì‹œì‘
    function startEmotionDetection() {
      document.getElementById('status').innerHTML = 'í‘œì •ì„ ë¶„ì„ ì¤‘...';
      document.getElementById('predictions').style.display = 'block';
      
      // ì‹œë®¬ë ˆì´ì…˜ëœ ê°ì • ë°ì´í„°
      const emotions = ['í–‰ë³µ', 'ìŠ¬í””', 'ë†€ëŒ', 'í™”ë‚¨', 'ì¤‘ì„±'];
      const predictionList = document.getElementById('prediction-list');
      
      setInterval(() => {
        predictionList.innerHTML = '';
        emotions.forEach(emotion => {
          const probability = Math.random();
          const item = document.createElement('div');
          item.className = 'prediction-item';
          item.innerHTML = `
            <span>${emotion}</span>
            <div class="prediction-bar">
              <div class="prediction-fill" style="width: ${probability * 100}%"></div>
            </div>
          `;
          predictionList.appendChild(item);
        });
        
        // ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ê°ì •ì— ë”°ë¼ ìŒì•… ì¶”ì²œ
        const dominantEmotion = emotions[Math.floor(Math.random() * emotions.length)];
        showMusicRecommendation(dominantEmotion);
      }, 1000);
    }

    // í”¼ë¶€ ìƒíƒœ ë¶„ì„ ì‹œì‘
    function startSkinDetection() {
      document.getElementById('status').innerHTML = 'í”¼ë¶€ ìƒíƒœë¥¼ ë¶„ì„ ì¤‘...';
      
      // 3ì´ˆ í›„ í”¼ë¶€ íƒ€ì… ì„ íƒ í™”ë©´ í‘œì‹œ
      setTimeout(() => {
        document.getElementById('status').innerHTML = '<span class="success">ë¶„ì„ ì™„ë£Œ! í”¼ë¶€ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>';
        document.getElementById('skin-type-selection').style.display = 'block';
      }, 3000);
    }

    // í”¼ë¶€ íƒ€ì… ì„ íƒ
    function selectSkinType(type) {
      selectedSkinType = type;
      
      // ëª¨ë“  ë²„íŠ¼ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
      document.querySelectorAll('.skin-type-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
      document.querySelector(`[data-type="${type}"]`).classList.add('selected');
      
      // í™”ì¥í’ˆ ì¶”ì²œ í‘œì‹œ
      setTimeout(() => {
        showCosmeticRecommendation(type);
      }, 500);
    }

    // í™”ì¥í’ˆ ì¶”ì²œ í‘œì‹œ
    function showCosmeticRecommendation(skinType) {
      const data = cosmeticData[skinType];
      const cosmeticContent = document.getElementById('cosmetic-content');
      
      let html = `<div class="cosmetic-title">${data.title}</div>`;
      
      data.categories.forEach(category => {
        html += `
          <div class="cosmetic-category">
            <div class="category-title">${category.name}</div>
            <div class="cosmetic-grid">
        `;
        
        category.products.forEach(product => {
          html += `
            <div class="cosmetic-item">
              <div class="cosmetic-name">${product.name}</div>
              <div class="cosmetic-description">${product.description}</div>
              <div class="cosmetic-links">
                <a href="${product.coupangUrl}" target="_blank" class="cosmetic-link coupang-link">ì¿ íŒ¡ì—ì„œ êµ¬ë§¤</a>
                <a href="${product.oliveyoungUrl}" target="_blank" class="cosmetic-link oliveyoung-link">ì˜¬ë¦¬ë¸Œì˜ì—ì„œ êµ¬ë§¤</a>
              </div>
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      cosmeticContent.innerHTML = html;
      document.getElementById('cosmetic-recommendation').style.display = 'block';
    }

    // ìŒì•… ì¶”ì²œ í‘œì‹œ (ê°ì • ì¸ì‹ìš©)
    function showMusicRecommendation(emotion) {
      const musicContent = document.getElementById('music-content');
      
      // ê°ì •ë³„ ìŒì•… ë°ì´í„° (ì‹œë®¬ë ˆì´ì…˜)
      const musicData = {
        'í–‰ë³µ': [
          { title: 'Happy - Pharrell Williams', channel: 'PhrarrellWilliamsVEVO', thumbnail: 'https://via.placeholder.com/240x135' },
          { title: 'Good as Hell - Lizzo', channel: 'LizzoMusic', thumbnail: 'https://via.placeholder.com/240x135' }
        ],
        'ìŠ¬í””': [
          { title: 'Someone Like You - Adele', channel: 'AdeleVEVO', thumbnail: 'https://via.placeholder.com/240x135' },
          { title: 'Fix You - Coldplay', channel: 'ColdplayVEVO', thumbnail: 'https://via.placeholder.com/240x135' }
        ],
        'ì¤‘ì„±': [
          { title: 'Shape of You - Ed Sheeran', channel: 'EdSheeranVEVO', thumbnail: 'https://via.placeholder.com/240x135' },
          { title: 'Blinding Lights - The Weeknd', channel: 'TheWeekndVEVO', thumbnail: 'https://via.placeholder.com/240x135' }
        ]
      };
      
      const songs = musicData[emotion] || musicData['ì¤‘ì„±'];
      
      let html = '<div class="music-grid">';
      songs.forEach(song => {
        html += `
          <div class="music-item" onclick="playMusic('${song.title}')">
            <img src="${song.thumbnail}" alt="${song.title}" class="music-thumbnail">
            <div class="music-info">
              <div class="music-title-text">${song.title}</div>
              <div class="music-channel">${song.channel}</div>
              <button class="play-button">ì¬ìƒ</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      musicContent.innerHTML = html;
      document.getElementById('music-recommendation').style.display = 'block';
    }

    // ìŒì•… ì¬ìƒ (ì‹œë®¬ë ˆì´ì…˜)
    function playMusic(title) {
      alert(`"${title}" ì¬ìƒ ì¤‘... (ì‹¤ì œ êµ¬í˜„ì‹œ YouTube API ë˜ëŠ” ìŒì•… í”Œë«í¼ ì—°ë™)`);
    }

    // ë‹¤ì‹œ ì‹œë„
    function restart() {
      document.getElementById('predictions').style.display = 'none';
      document.getElementById('music-recommendation').style.display = 'none';
      document.getElementById('skin-type-selection').style.display = 'none';
      document.getElementById('cosmetic-recommendation').style.display = 'none';
      selectedSkinType = '';
      
      // ëª¨ë“  í”¼ë¶€ íƒ€ì… ë²„íŠ¼ ì„ íƒ í•´ì œ
      document.querySelectorAll('.skin-type-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      startDetection();
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í™•ì¸
    window.addEventListener('load', () => {
      // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ì‹¤ì œ êµ¬í˜„ì‹œ)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
          .then(() => console.log('Service Worker registered'))
          .catch(() => console.log('Service Worker registration failed'));
      }
    });
  </script>
</body>
</html>